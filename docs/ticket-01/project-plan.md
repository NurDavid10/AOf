# Project Plan: Academic Tomorrow Learning Center Management System

## Ticket Reference
**Ticket ID:** ticket-01
**Type:** Epic
**Goal:** Build the 3-layer architecture and domain model for "Academic Tomorrow" Learning Center Management System

---

## Technology Stack

- **Language:** Python 3.13+
- **Package Manager:** uv (with pyproject.toml)
- **Database:** MySQL
- **Backend Framework:** FastAPI
- **Frontend UI:** Tailwind CSS
- **ORM:** SQLAlchemy (for MySQL integration)
- **Core Dependencies:**
  - fastapi
  - uvicorn[standard] (ASGI server)
  - sqlalchemy
  - pymysql
  - pydantic
  - python-multipart (for form handling)
  - jinja2 (for templating)
  - python-dotenv (for environment variables)
  - bcrypt (for password hashing)

---

## Architecture Overview

### Three-Layer Architecture

```
┌─────────────────────────────────────┐
│     Frontend Layer (FastAPI)        │
│  - Web routes & templates           │
│  - Login & role-based routing       │
│  - Tailwind CSS UI                  │
└──────────────┬──────────────────────┘
               │
┌──────────────▼──────────────────────┐
│     Business Logic Layer            │
│  - Validations (unique username)    │
│  - Queue management automation      │
│  - Financial calculations           │
│  - Role-based access control        │
└──────────────┬──────────────────────┘
               │
┌──────────────▼──────────────────────┐
│     Data Layer (MySQL + ORM)        │
│  - Database schema & models         │
│  - CRUD operations                  │
│  - Users, Courses, Tasks, Payments  │
│  - Queues                           │
└─────────────────────────────────────┘
```

---

## Phase 1: Project Setup & Structure

### 1.1 Directory Structure
```
academic_tomorrow/
├── app/
│   ├── __init__.py
│   ├── main.py                    # FastAPI application entry point
│   ├── config.py                  # Configuration management
│   ├── database.py                # Database connection & session
│   ├── models/                    # Data Layer (ORM models)
│   │   ├── __init__.py
│   │   ├── base.py               # Base model classes
│   │   ├── user.py               # User hierarchy models
│   │   ├── course.py             # Course models
│   │   ├── task.py               # Task models
│   │   ├── payment.py            # Payment models
│   │   └── queue.py              # Queue models
│   ├── services/                  # Business Logic Layer
│   │   ├── __init__.py
│   │   ├── auth_service.py       # Authentication & authorization
│   │   ├── user_service.py       # User management logic
│   │   ├── course_service.py     # Course management logic
│   │   ├── task_service.py       # Task management logic
│   │   ├── payment_service.py    # Payment & financial calculations
│   │   └── queue_service.py      # Queue automation logic
│   ├── routers/                   # Frontend Layer (API routes)
│   │   ├── __init__.py
│   │   ├── auth.py               # Login/logout routes
│   │   ├── manager.py            # Manager dashboard & routes
│   │   ├── teacher.py            # Teacher dashboard & routes
│   │   ├── student.py            # Student dashboard & routes
│   │   ├── parent.py             # Parent dashboard & routes
│   │   └── worker.py             # Worker dashboard & routes
│   ├── templates/                 # HTML templates (Jinja2)
│   │   ├── base.html             # Base template with Tailwind CSS
│   │   ├── login.html            # Login page
│   │   ├── manager/              # Manager templates
│   │   ├── teacher/              # Teacher templates
│   │   ├── student/              # Student templates
│   │   ├── parent/               # Parent templates
│   │   └── worker/               # Worker templates
│   ├── static/                    # Static files
│   │   ├── css/
│   │   └── js/
│   └── schemas/                   # Pydantic schemas for validation
│       ├── __init__.py
│       ├── user_schema.py
│       ├── course_schema.py
│       ├── task_schema.py
│       ├── payment_schema.py
│       └── queue_schema.py
├── scripts/
│   ├── init_db.py                # Database initialization script
│   ├── seed_data.py              # Dummy data generation
│   └── reset_db.py               # Database reset script (re-runnable)
├── .env.example                   # Example environment variables
├── .env                          # Environment variables (gitignored)
├── .gitignore                    # Git ignore file
├── pyproject.toml                # Project configuration & dependencies
├── uv.lock                       # Lockfile (auto-generated by uv)
└── README.md                     # Basic run steps
```

### 1.2 pyproject.toml Configuration
```toml
[project]
name = "academic-tomorrow"
version = "0.1.0"
description = "Learning Center Management System"
requires-python = ">=3.13"
dependencies = [
    "fastapi>=0.110.0",
    "uvicorn[standard]>=0.27.0",
    "sqlalchemy>=2.0.25",
    "pymysql>=1.1.0",
    "pydantic>=2.6.0",
    "pydantic-settings>=2.1.0",
    "python-multipart>=0.0.9",
    "jinja2>=3.1.3",
    "python-dotenv>=1.0.1",
    "bcrypt>=4.1.2",
]

[build-system]
requires = ["hatchling"]
build-backend = "hatchling.build"

[tool.uv]
dev-dependencies = []
```

### 1.3 Environment Setup
**.env file structure:**
```env
DB_HOST=localhost
DB_PORT=3306
DB_USER=root
DB_PASSWORD=yourpassword
DB_NAME=academic_tomorrow
SECRET_KEY=your-secret-key-here
```

### 1.4 uv Setup Commands
```bash
# Install uv (if not installed)
curl -LsSf https://astral.sh/uv/install.sh | sh

# Create project
uv init academic_tomorrow
cd academic_tomorrow

# Add dependencies
uv add fastapi uvicorn[standard] sqlalchemy pymysql pydantic pydantic-settings python-multipart jinja2 python-dotenv bcrypt

# Run the application
uv run uvicorn app.main:app --reload
```

---

## Phase 2: Data Layer (Database & ORM Models)

### 2.1 Database Schema Design

#### Tables:
1. **users** (base table)
   - id (PK, INT, AUTO_INCREMENT)
   - username (VARCHAR, UNIQUE, NOT NULL)
   - password_hash (VARCHAR, NOT NULL)
   - email (VARCHAR, UNIQUE)
   - full_name (VARCHAR)
   - role (ENUM: 'manager', 'parent', 'teacher', 'student', 'worker')
   - created_at (TIMESTAMP)
   - updated_at (TIMESTAMP)

2. **managers** (extends users)
   - user_id (FK → users.id, PK)
   - department (VARCHAR)
   - access_level (INT)

3. **teachers** (extends users)
   - user_id (FK → users.id, PK)
   - subject_specialization (VARCHAR)
   - hire_date (DATE)
   - salary (DECIMAL)

4. **students** (extends users)
   - user_id (FK → users.id, PK)
   - enrollment_date (DATE)
   - grade_level (VARCHAR)
   - parent_id (FK → parents.user_id, nullable)

5. **parents** (extends users)
   - user_id (FK → users.id, PK)
   - phone_number (VARCHAR)
   - address (TEXT)

6. **workers** (extends users)
   - user_id (FK → users.id, PK)
   - job_title (VARCHAR)
   - hire_date (DATE)
   - hourly_rate (DECIMAL)

7. **courses**
   - id (PK, INT, AUTO_INCREMENT)
   - course_name (VARCHAR, NOT NULL)
   - course_code (VARCHAR, UNIQUE)
   - description (TEXT)
   - teacher_id (FK → teachers.user_id)
   - capacity (INT)
   - start_date (DATE)
   - end_date (DATE)
   - fee (DECIMAL)

8. **course_enrollments**
   - id (PK, INT, AUTO_INCREMENT)
   - student_id (FK → students.user_id)
   - course_id (FK → courses.id)
   - enrollment_date (TIMESTAMP)
   - status (ENUM: 'active', 'completed', 'dropped')

9. **tasks**
   - id (PK, INT, AUTO_INCREMENT)
   - title (VARCHAR, NOT NULL)
   - description (TEXT)
   - course_id (FK → courses.id)
   - due_date (DATETIME)
   - created_by (FK → users.id)
   - task_type (ENUM: 'assignment', 'exam', 'project', 'homework')

10. **task_submissions**
    - id (PK, INT, AUTO_INCREMENT)
    - task_id (FK → tasks.id)
    - student_id (FK → students.user_id)
    - submission_date (TIMESTAMP)
    - grade (DECIMAL, nullable)
    - feedback (TEXT)

11. **payments**
    - id (PK, INT, AUTO_INCREMENT)
    - payer_id (FK → users.id)
    - amount (DECIMAL, NOT NULL)
    - payment_type (ENUM: 'tuition', 'fee', 'salary', 'other')
    - payment_method (ENUM: 'cash', 'card', 'transfer')
    - payment_date (TIMESTAMP)
    - status (ENUM: 'pending', 'completed', 'cancelled')
    - reference_id (INT, nullable)

12. **queues**
    - id (PK, INT, AUTO_INCREMENT)
    - queue_name (VARCHAR, NOT NULL)
    - description (TEXT)
    - queue_type (ENUM: 'registration', 'payment', 'support', 'general')
    - created_at (TIMESTAMP)

13. **queue_items**
    - id (PK, INT, AUTO_INCREMENT)
    - queue_id (FK → queues.id)
    - user_id (FK → users.id)
    - position (INT)
    - status (ENUM: 'waiting', 'in_progress', 'completed', 'cancelled')
    - priority (INT, default 0)
    - joined_at (TIMESTAMP)
    - completed_at (TIMESTAMP, nullable)

### 2.2 ORM Models (SQLAlchemy)

#### Inheritance Hierarchy:
```python
# Base User class (demonstrates OOP inheritance)
class User(Base):
    __tablename__ = 'users'
    # Common fields
    # Abstract methods to be overridden (polymorphism)
    # Getters/setters with @property (encapsulation)

# Derived classes
class Manager(User):
    __tablename__ = 'managers'
    # Override polymorphic methods

class Teacher(User):
    __tablename__ = 'teachers'
    # Override polymorphic methods

class Student(User):
    __tablename__ = 'students'
    # Override polymorphic methods

class Parent(User):
    __tablename__ = 'parents'
    # Override polymorphic methods

class Worker(User):
    __tablename__ = 'workers'
    # Override polymorphic methods
```

#### OOP Principles Implementation:
- **Inheritance:** User → Manager/Teacher/Student/Parent/Worker
- **Polymorphism:** Override methods like `get_dashboard_data()`, `get_permissions()`, `can_access()`
- **Encapsulation:** Use @property decorators for getters/setters, private attributes with `_`

### 2.3 CRUD Operations
- Implement repository pattern for each model
- Generic base repository with CRUD methods (create, read, update, delete)
- Specialized methods for complex queries
- All database operations wrapped in try/except blocks

---

## Phase 3: Business Logic Layer

### 3.1 Authentication & Authorization Service
- User login validation
- Password hashing with bcrypt
- Session/cookie management
- Role-based access control (RBAC)
- Middleware for protected routes

### 3.2 User Service
- **Validate unique username** during registration (required validation)
- User profile management
- Password reset functionality
- User creation with role assignment
- Error handling with user-friendly messages

### 3.3 Course Service
- Course creation and enrollment logic
- Capacity validation (prevent over-enrollment)
- Teacher assignment validation
- Course fee calculation
- Enrollment status management

### 3.4 Task Service
- Task creation with deadline validation
- Assignment to courses
- Grading logic
- Submission tracking
- Deadline enforcement

### 3.5 Payment Service
- **Financial calculations (required):**
  - Tuition fee calculation based on enrolled courses
  - Payment plan management
  - Salary calculation for teachers/workers
  - Outstanding balance tracking
  - Payment history and receipts
  - Total revenue calculation
  - Pending payments tracking

### 3.6 Queue Service
- **Automated queue handling (required):**
  - Auto-position assignment when user joins queue
  - Priority-based queue ordering
  - Automatic status updates (waiting → in_progress → completed)
  - Queue capacity management
  - Next-in-line determination
  - Queue statistics (average wait time, current length)

### 3.7 Error Handling
- Try/except blocks for all database operations
- Try/except for all business logic validations
- Custom exception classes for specific errors
- User-friendly error messages displayed on frontend
- Logging for debugging (using Python's logging module)

---

## Phase 4: Frontend Layer (FastAPI + Tailwind CSS)

### 4.1 Authentication Routes
- `GET /` - Landing page / redirect to login
- `GET /login` - Login form with Tailwind CSS styling
- `POST /login` - Login processing with role detection
- `GET /logout` - Logout and session cleanup
- Middleware to protect routes

### 4.2 Role-Based Routing

#### Manager Routes (`/manager/*`)
- `GET /manager/dashboard` - Overview statistics (total users, courses, revenue)
- `GET /manager/users` - Manage all users (CRUD)
- `GET /manager/courses` - Manage courses
- `GET /manager/payments` - Financial reports & analytics
- `GET /manager/queues` - Queue management & monitoring

#### Teacher Routes (`/teacher/*`)
- `GET /teacher/dashboard` - Teacher overview
- `GET /teacher/courses` - My assigned courses
- `GET /teacher/tasks` - Create/manage tasks for my courses
- `GET /teacher/students` - View enrolled students & grades
- `POST /teacher/tasks/create` - Create new task
- `POST /teacher/grade` - Submit grades

#### Student Routes (`/student/*`)
- `GET /student/dashboard` - Student overview (enrolled courses, pending tasks)
- `GET /student/courses` - My enrolled courses
- `GET /student/tasks` - View assigned tasks & submit work
- `GET /student/payments` - Payment history & balance
- `GET /student/queue/join` - Join a queue
- `POST /student/tasks/submit` - Submit task

#### Parent Routes (`/parent/*`)
- `GET /parent/dashboard` - Children overview
- `GET /parent/children` - View children's academic data
- `GET /parent/payments` - Payment management for children
- `GET /parent/reports` - Children's progress reports

#### Worker Routes (`/worker/*`)
- `GET /worker/dashboard` - Worker overview
- `GET /worker/tasks` - Assigned maintenance/admin tasks
- `GET /worker/schedule` - Work schedule & hours
- `GET /worker/payments` - Salary & payment history

### 4.3 Templates with Tailwind CSS
- **base.html** - Base template with:
  - Tailwind CSS CDN link
  - Navigation bar (changes based on logged-in role)
  - Footer
  - Flash message display area

- **login.html** - Login form with Tailwind styling

- **Role-specific dashboards** with:
  - Responsive grid layout
  - Dashboard cards/widgets
  - Data tables with Tailwind table classes
  - Forms with Tailwind form styling
  - Buttons and alerts

### 4.4 Static Assets
- Tailwind CSS via CDN (or compiled if custom styling needed)
- Minimal JavaScript for:
  - Form validation
  - Interactive elements (dropdowns, modals)
  - AJAX requests (optional)

---

## Phase 5: Database Initialization & Scripts

### 5.1 Schema Creation Script (`scripts/init_db.py`)
- Create database if not exists
- Drop tables if exist (for re-runnability)
- Create all tables in correct order (respecting foreign keys)
- Create indexes for performance (username, email, course_code)
- Set up foreign key constraints
- Run using: `uv run python scripts/init_db.py`

### 5.2 Dummy Data Script (`scripts/seed_data.py`)
Create sample data:
- **Managers:** 2 users (e.g., admin, director)
- **Teachers:** 5 users with different subjects
- **Students:** 15 users across different grade levels
- **Parents:** 10 users linked to students
- **Workers:** 3 users (maintenance, admin assistant, etc.)
- **Courses:** 8-10 courses with assigned teachers
- **Enrollments:** Students enrolled in 2-4 courses each
- **Tasks:** 15-20 tasks across courses
- **Payments:** Sample payment records (tuition, salaries)
- **Queues:** 2-3 queues with several queue items

### 5.3 Reset Script (`scripts/reset_db.py`)
- Combine drop, create, and seed in one script
- Provide confirmation prompt before execution
- Re-runnable without errors
- Run using: `uv run python scripts/reset_db.py`

---

## Implementation Timeline

### Week 1: Foundation & Data Layer
- **Day 1:** Project setup (uv, pyproject.toml, directory structure, .env)
- **Day 2:** Database schema design and SQLAlchemy models
- **Day 3:** ORM models with inheritance (User → role classes)
- **Day 4:** CRUD operations and repository pattern
- **Day 5:** Database scripts (init_db.py, seed_data.py, reset_db.py)

### Week 2: Business Logic Layer
- **Day 1:** Authentication service & password hashing
- **Day 2:** User service with unique username validation
- **Day 3:** Course service & task service
- **Day 4:** Payment service with financial calculations
- **Day 5:** Queue service with automation logic
- **Day 6-7:** Error handling throughout all services

### Week 3: Frontend Layer
- **Day 1:** Base templates, Tailwind CSS setup, login page
- **Day 2:** Authentication routes and session management
- **Day 3:** Manager & Teacher dashboards
- **Day 4:** Student & Parent dashboards
- **Day 5:** Worker dashboard
- **Day 6-7:** Forms, data tables, styling refinement

### Week 4: Integration & Polish
- **Day 1-2:** Full integration testing (frontend ↔ business ↔ DB)
- **Day 3-4:** Bug fixes and error handling improvements
- **Day 5:** README with run steps and default credentials
- **Day 6-7:** Code cleanup, add docstrings, final review

---

## Acceptance Criteria Checklist

- [ ] Code runs without errors
- [ ] Frontend connects to business logic layer
- [ ] Business logic connects to database layer
- [ ] Login page loads and accepts credentials
- [ ] **Login correctly identifies user roles** (manager/teacher/student/parent/worker)
- [ ] **Each role redirects to appropriate dashboard**
- [ ] Database initialization script runs successfully
- [ ] Database reset script is re-runnable
- [ ] Dummy data populates correctly
- [ ] **OOP inheritance:** User → Manager/Teacher/Student/Parent/Worker
- [ ] **OOP polymorphism:** Overridden methods in derived classes
- [ ] **OOP encapsulation:** Getters/setters with @property
- [ ] **Try/except error handling** throughout the code
- [ ] **User-friendly error messages** displayed on frontend
- [ ] All classes have docstrings
- [ ] All methods have docstrings
- [ ] **README.md with run steps** (how to set up DB, install deps, run app)
- [ ] README includes default login credentials for each role

---

## README.md Structure (Basic)

```markdown
# Academic Tomorrow Learning Center Management System

## Prerequisites
- Python 3.13+
- MySQL 8.0+
- uv package manager

## Setup

### 1. Install uv
curl -LsSf https://astral.sh/uv/install.sh | sh

### 2. Clone & Install Dependencies
git clone <repo-url>
cd academic_tomorrow
uv sync

### 3. Configure MySQL Database
mysql -u root -p
CREATE DATABASE academic_tomorrow;
exit;

### 4. Configure Environment
cp .env.example .env
# Edit .env with your MySQL credentials

### 5. Initialize Database
uv run python scripts/reset_db.py

### 6. Run Application
uv run uvicorn app.main:app --reload

### 7. Access Application
Open browser: http://localhost:8000

## Default Login Credentials

Manager:
- Username: manager1
- Password: password123

Teacher:
- Username: teacher1
- Password: password123

Student:
- Username: student1
- Password: password123

Parent:
- Username: parent1
- Password: password123

Worker:
- Username: worker1
- Password: password123

## Architecture
3-Layer Architecture:
- Frontend Layer (FastAPI + Jinja2 + Tailwind CSS)
- Business Logic Layer (Services & Validations)
- Data Layer (SQLAlchemy ORM + MySQL)

## Project Structure
See ARCHITECTURE.md for details
```

---

## Risk Mitigation

### Technical Risks
- **Database connection issues:** Clear error messages + .env.example template
- **ORM complexity:** Start with simple models, add relationships incrementally
- **Authentication security:** Use bcrypt, secure session management

### Implementation Risks
- **Scope creep:** Stick strictly to acceptance criteria
- **Time overruns:** Prioritize core features (login, CRUD, basic dashboards)
- **Python 3.13 compatibility:** Verify all packages support Python 3.13

---

## Questions for Clarification

Before implementation, please clarify:

1. **Queue System Details:**
   - What specific queue types are needed? (registration, payment, counseling, etc.)
   - Should queues auto-advance when someone is served?
   - Any maximum wait time rules?

2. **Financial Calculations Specifics:**
   - What formulas for tuition? (per course, flat rate, discounts?)
   - Teacher salary: fixed monthly or per-course?
   - Worker pay: hourly × hours worked?
   - Any tax calculations needed?

3. **Task Management:**
   - Should tasks auto-close after due date?
   - Grade scale (0-100, A-F, pass/fail)?
   - Can students resubmit tasks?

4. **Authentication:**
   - Session timeout duration?
   - Password complexity requirements?
   - "Remember me" functionality?

5. **Dashboard Content:**
   - What specific statistics on each role's dashboard?
   - Any charts/graphs needed?

---

## Cleanup Notes

**Removed Ticket 04 (Worker Role Implementation Plan):**
- Ticket 04 documentation has been removed as it is no longer needed
- Worker functionality is fully defined in Tickets 01-03 via web interface only
- Worker role is implemented through `app/routers/worker_routes.py` and `MaintenanceService`
- All roles (Manager, Teacher, Student, Parent, Worker) access the system exclusively through the web interface
- No CLI interfaces exist in the system

---

**End of Updated Project Plan**
